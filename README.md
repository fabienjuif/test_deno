# test deno

## Install and test deno

From the [official website](https://deno.land/)

1. Install deno: `curl -fsSL https://deno.land/x/install/install.sh | sh`
2. Test it: `deno run https://deno.land/std/examples/welcome.ts`

## Observations

1. Deno "compiles" typescript files before executing them

```
âžœ  test_deno deno run src/first.ts
Compile file:///home/fabienjuif/work/test_deno/src/first.ts
44
âžœ  test_deno deno run src/first.ts
44
```

2. Deno do not "compiles" javascript files

```
âžœ  test_deno deno run src/second.js
44
âžœ  test_deno deno run src/second.js
44
```

3. Deno seems to keep track of compiled files in ~/.cache, eg:

```
/home/fabienjuif/.cache/deno/gen/file/home/fabienjuif/work/test_deno/src:
first.ts.graph  first.ts.js  first.ts.js.map  first.ts.meta
```

If I move the directory (rename it for example), how deno will clean up?
It seems to compile the file again

```
âžœ  test_deno2 deno run src/first.ts
Compile file:///home/fabienjuif/work/test_deno2/src/first.ts
44
```

ðŸ›‘ **And the cache is not cleaned up**:

```
âžœ  test_deno2 ls /home/fabienjuif/.cache/deno/gen/file/home/fabienjuif/work/test_deno/src
first.ts.graph  first.ts.js  first.ts.js.map  first.ts.meta
```

4. **await** can be used at top level
5. Deno has its own error reporting system, eg:

```
âžœ  test_deno deno run --unstable --allow-read src/3.ls.ts
error: Unterminated template at file:///home/fabienjuif/work/test_deno/src/3.ls.ts:4:14
```

6. CLI args are accessibles via `Deno.args`
7. It is possible to know that a module is executed at the main module with: `import.meta.main`
8. If a js file import a typescript module, the compilation is processed ðŸ›‘ **everytime**

```
âžœ  test_deno deno run --unstable --allow-read src/5.ls.js
Compile file:///home/fabienjuif/work/test_deno/src/5.ls.js
./
src/
README.md
âžœ  test_deno deno run --unstable --allow-read src/5.ls.js
Compile file:///home/fabienjuif/work/test_deno/src/5.ls.js
./
src/
README.md
```

9. We can install a script as a binary in \$DENO_HOME/bin with `deno install`
10. Looking at the installed CLI, it seems not usable in a Docker file since it only references the source script.

```
âžœ  test_deno cat /home/fabienjuif/.deno/bin/ls
#!/bin/sh
# generated by deno install
deno "run" "--allow-read" "--unstable" "file:///home/fabienjuif/work/test_deno/src/3.ls.ts" "$@"
```
